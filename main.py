import pandas as pd
import pickle
import sys
import os

from model import RandomForestClassifier, DecisionTreeClassifier, Node # For model (When Unpickled)
from dataset import get_attributes

if __name__ == '__main__':

    FILE_PATH = 'data/test.exe'

    # Check File Exists
    if not os.path.exists(FILE_PATH):
        print('File not found')
        sys.exit()

    # Extract File Attributes
    attributes = get_attributes(FILE_PATH, -1)

    # Convert to DataFrame
    data = pd.DataFrame(attributes, index=[0])

    # Clean Data
    data = data.drop(['Name', 'Malware', 'MD5'], axis=1).to_numpy()

    # Check if Model Exists
    if not os.path.exists('model.pkl'):
        print('Model not found')
        sys.exit()

    # Load Model
    with open('model.pkl', 'rb') as f:
        model = pickle.load(f)

    # Predict
    prediction = model.predict(data)

    # Output Results
    print(f'Prediction: {"Malware" if prediction[0] else "Benign"}')
